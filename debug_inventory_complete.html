<!DOCTYPE html>
<html>
<head>
    <title>Full Inventory Debug</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
        }
        .response {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 11px;
            max-height: 300px;
            overflow: auto;
            border: 1px solid #ddd;
            margin: 10px 0;
        }
        .success { background: #f6ffed; border-color: #b7eb8f; color: #389e0d; }
        .error { background: #fff2f0; border-color: #ffccc7; color: #cf1322; }
        .warning { background: #fffbe6; border-color: #ffe58f; color: #d46b08; }
        button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #40a9ff; }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-ok { background: #52c41a; }
        .status-error { background: #ff4d4f; }
        .status-warning { background: #faad14; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Inventory Data Debug - Complete Test</h1>
        
        <div class="test-section">
            <h2>üì° Backend API Status</h2>
            <button onclick="testAllAPIs()">Test All APIs</button>
            <button onclick="clearResults()">Clear Results</button>
            
            <div id="apiStatus" style="margin: 10px 0;">
                <div><span class="status-indicator status-warning"></span>Click "Test All APIs" to check backend</div>
            </div>
        </div>

        <div class="test-section">
            <h2>üñ•Ô∏è Servers API</h2>
            <button onclick="testServers()">Test Servers</button>
            <div id="serversResult" class="response">Not tested yet</div>
        </div>

        <div class="test-section">
            <h2>üóÑÔ∏è Databases API</h2>
            <button onclick="testDatabases()">Test Databases</button>
            <div id="databasesResult" class="response">Not tested yet</div>
        </div>

        <div class="test-section">
            <h2>üìÅ File Shares API</h2>
            <button onclick="testFileShares()">Test File Shares</button>
            <div id="fileSharesResult" class="response">Not tested yet</div>
        </div>

        <div class="test-section">
            <h2>üí∞ Resource Rates API</h2>
            <button onclick="testResourceRates()">Test Resource Rates</button>
            <div id="resourceRatesResult" class="response">Not tested yet</div>
        </div>

        <div class="test-section">
            <h2>üè† Dashboard API</h2>
            <button onclick="testDashboard()">Test Dashboard</button>
            <div id="dashboardResult" class="response">Not tested yet</div>
        </div>

        <div class="test-section">
            <h2>üß™ Frontend Simulation</h2>
            <button onclick="simulateFrontendLogic()">Simulate React Component Logic</button>
            <div id="frontendSimResult" class="response">Not tested yet</div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        let testResults = {};

        function updateStatus(endpoint, success, message) {
            testResults[endpoint] = { success, message };
            
            // Update overall status
            const statusDiv = document.getElementById('apiStatus');
            const totalTests = Object.keys(testResults).length;
            const successfulTests = Object.values(testResults).filter(r => r.success).length;
            
            let statusClass, statusText;
            if (totalTests === 0) {
                statusClass = 'status-warning';
                statusText = 'No tests run yet';
            } else if (successfulTests === totalTests) {
                statusClass = 'status-ok';
                statusText = `All ${totalTests} APIs working`;
            } else if (successfulTests > 0) {
                statusClass = 'status-warning';
                statusText = `${successfulTests}/${totalTests} APIs working`;
            } else {
                statusClass = 'status-error';
                statusText = `All ${totalTests} APIs failing`;
            }
            
            statusDiv.innerHTML = `<div><span class="status-indicator ${statusClass}"></span>${statusText}</div>`;
        }

        async function testEndpoint(endpoint, elementId) {
            const element = document.getElementById(elementId);
            element.textContent = 'Testing...';
            element.className = 'response';
            
            try {
                const response = await fetch(`${API_BASE}${endpoint}`);
                const data = await response.json();
                
                if (response.ok) {
                    let result = `‚úÖ SUCCESS - ${endpoint}\nStatus: ${response.status}\n\n`;
                    result += JSON.stringify(data, null, 2);
                    
                    // Add analysis
                    if (data) {
                        result += '\n\n=== ANALYSIS ===\n';
                        Object.keys(data).forEach(key => {
                            const value = data[key];
                            if (Array.isArray(value)) {
                                result += `${key}: Array with ${value.length} items\n`;
                                if (value.length > 0) {
                                    result += `  ‚îî‚îÄ Sample keys: ${Object.keys(value[0]).join(', ')}\n`;
                                }
                            } else {
                                result += `${key}: ${typeof value} = ${value}\n`;
                            }
                        });
                    }
                    
                    element.textContent = result;
                    element.className = 'response success';
                    updateStatus(endpoint, true, 'OK');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                element.textContent = `‚ùå FAILED - ${endpoint}\nError: ${error.message}`;
                element.className = 'response error';
                updateStatus(endpoint, false, error.message);
            }
        }

        function testServers() {
            testEndpoint('/servers', 'serversResult');
        }

        function testDatabases() {
            testEndpoint('/databases', 'databasesResult');
        }

        function testFileShares() {
            testEndpoint('/file-shares', 'fileSharesResult');
        }

        function testResourceRates() {
            testEndpoint('/resource-rates', 'resourceRatesResult');
        }

        function testDashboard() {
            testEndpoint('/dashboard', 'dashboardResult');
        }

        async function testAllAPIs() {
            const endpoints = [
                { endpoint: '/servers', elementId: 'serversResult' },
                { endpoint: '/databases', elementId: 'databasesResult' },
                { endpoint: '/file-shares', elementId: 'fileSharesResult' },
                { endpoint: '/resource-rates', elementId: 'resourceRatesResult' },
                { endpoint: '/dashboard', elementId: 'dashboardResult' }
            ];

            for (const {endpoint, elementId} of endpoints) {
                await testEndpoint(endpoint, elementId);
                await new Promise(resolve => setTimeout(resolve, 500)); // Small delay between tests
            }

            // Auto-run frontend simulation
            setTimeout(simulateFrontendLogic, 1000);
        }

        async function simulateFrontendLogic() {
            const element = document.getElementById('frontendSimResult');
            element.textContent = 'Running frontend simulation...';
            element.className = 'response';

            try {
                let result = 'üß™ FRONTEND COMPONENT SIMULATION\n\n';
                
                // Test servers like React component would
                result += '1. Testing Servers Component Logic:\n';
                const serversResponse = await fetch(`${API_BASE}/servers`);
                const serversData = await serversResponse.json();
                
                if (serversData.servers && Array.isArray(serversData.servers)) {
                    result += `   ‚úÖ setServers(data.servers) - Found ${serversData.servers.length} servers\n`;
                    result += `   ‚úÖ First server: ${JSON.stringify(serversData.servers[0])}\n`;
                } else if (Array.isArray(serversData)) {
                    result += `   ‚ö†Ô∏è  Direct array format - ${serversData.length} servers\n`;
                } else {
                    result += `   ‚ùå Unexpected format: ${JSON.stringify(serversData)}\n`;
                }
                
                // Test databases
                result += '\n2. Testing Databases Component Logic:\n';
                const dbResponse = await fetch(`${API_BASE}/databases`);
                const dbData = await dbResponse.json();
                
                if (dbData.databases && Array.isArray(dbData.databases)) {
                    result += `   ‚úÖ setDatabases(data.databases) - Found ${dbData.databases.length} databases\n`;
                } else {
                    result += `   ‚ùå Missing databases array in response\n`;
                }
                
                // Test file shares
                result += '\n3. Testing File Shares Component Logic:\n';
                const fsResponse = await fetch(`${API_BASE}/file-shares`);
                const fsData = await fsResponse.json();
                
                if (fsData.file_shares && Array.isArray(fsData.file_shares)) {
                    result += `   ‚úÖ setFileShares(data.file_shares) - Found ${fsData.file_shares.length} file shares\n`;
                } else {
                    result += `   ‚ùå Missing file_shares array in response\n`;
                }
                
                result += '\n4. Component State Summary:\n';
                result += `   - Servers array length: ${serversData.servers?.length || 0}\n`;
                result += `   - Databases array length: ${dbData.databases?.length || 0}\n`;
                result += `   - File shares array length: ${fsData.file_shares?.length || 0}\n`;
                
                if ((serversData.servers?.length || 0) > 0 && 
                    (dbData.databases?.length || 0) > 0 && 
                    (fsData.file_shares?.length || 0) > 0) {
                    result += '\n‚úÖ ALL COMPONENTS SHOULD DISPLAY DATA';
                } else {
                    result += '\n‚ùå SOME COMPONENTS WILL BE EMPTY';
                }

                element.textContent = result;
                element.className = 'response success';
                
            } catch (error) {
                element.textContent = `‚ùå Frontend simulation failed: ${error.message}`;
                element.className = 'response error';
            }
        }

        function clearResults() {
            testResults = {};
            document.getElementById('apiStatus').innerHTML = '<div><span class="status-indicator status-warning"></span>Click "Test All APIs" to check backend</div>';
            ['serversResult', 'databasesResult', 'fileSharesResult', 'resourceRatesResult', 'dashboardResult', 'frontendSimResult'].forEach(id => {
                const element = document.getElementById(id);
                element.textContent = 'Not tested yet';
                element.className = 'response';
            });
        }

        // Auto-run on page load
        window.addEventListener('load', () => {
            console.log('üöÄ Starting comprehensive inventory debug...');
            setTimeout(testAllAPIs, 1000);
        });
    </script>
</body>
</html>

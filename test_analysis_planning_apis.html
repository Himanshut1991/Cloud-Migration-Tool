<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis & Planning API Tests</title>
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container { 
            background: white; 
            padding: 20px; 
            margin: 10px 0; 
            border-radius: 8px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-section { 
            border-left: 4px solid #1890ff; 
            padding-left: 16px; 
            margin: 20px 0; 
        }
        .success { border-left-color: #52c41a; }
        .error { border-left-color: #ff4d4f; }
        .warning { border-left-color: #faad14; }
        button { 
            background: #1890ff; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            margin: 8px; 
            border-radius: 6px; 
            cursor: pointer;
            font-size: 14px;
        }
        button:hover { background: #40a9ff; }
        button.danger { background: #ff4d4f; }
        button.success { background: #52c41a; }
        pre { 
            background: #f6f8fa; 
            padding: 16px; 
            border-radius: 6px; 
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
            font-size: 12px;
        }
        .stats { 
            display: flex; 
            gap: 20px; 
            margin: 20px 0; 
        }
        .stat-card { 
            background: #fafafa; 
            padding: 16px; 
            border-radius: 8px; 
            text-align: center; 
            flex: 1;
            border: 1px solid #e8e8e8;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #1890ff;
            margin-bottom: 5px;
        }
        .endpoint-test {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
        }
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status-working { background: #f6ffed; color: #52c41a; border: 1px solid #b7eb8f; }
        .status-error { background: #fff2f0; color: #ff4d4f; border: 1px solid #ffccc7; }
        .status-testing { background: #f0f9ff; color: #1890ff; border: 1px solid #91d5ff; }
        .timeline-test {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Analysis & Planning API Tests</h1>
        <p><strong>Purpose:</strong> Test all three analysis endpoints after fixes - Cost Estimation, Migration Strategy, and Timeline</p>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="backendStatus">üîÑ</div>
                <div>Backend Status</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="costStatus">‚è≥</div>
                <div>Cost Estimation</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="strategyStatus">‚è≥</div>
                <div>Migration Strategy</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="timelineStatus">‚è≥</div>
                <div>Timeline</div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="endpoint-test">
            <h2>üè• Backend Health Check</h2>
            <button onclick="testBackendHealth()">Test Backend Health</button>
            <div id="healthOutput"></div>
        </div>
    </div>

    <div class="container">
        <div class="endpoint-test">
            <h2>üí∞ Cost Estimation API</h2>
            <span class="status-badge status-testing" id="costBadge">Testing...</span>
            <button onclick="testCostEstimation()">Test Cost Estimation</button>
            <button onclick="testCostEstimationDetailed()">Test Detailed Response</button>
            <div id="costOutput"></div>
        </div>
    </div>

    <div class="container">
        <div class="endpoint-test">
            <h2>üéØ Migration Strategy API</h2>
            <span class="status-badge status-testing" id="strategyBadge">Testing...</span>
            <button onclick="testMigrationStrategy()">Test Migration Strategy</button>
            <button onclick="testMigrationStrategyDetailed()">Test Detailed Response</button>
            <div id="strategyOutput"></div>
        </div>
    </div>

    <div class="container">
        <div class="endpoint-test">
            <h2>üìÖ Timeline API</h2>
            <span class="status-badge status-testing" id="timelineBadge">Testing...</span>
            <div class="timeline-test">
                <h3>Timeline with Default Date</h3>
                <button onclick="testTimelineDefault()">Test Default Timeline</button>
            </div>
            <div class="timeline-test">
                <h3>Timeline with Custom Start Date</h3>
                <input type="date" id="customDate" value="2025-10-15" style="padding: 8px; margin-right: 10px;">
                <button onclick="testTimelineCustomDate()">Test Custom Date Timeline</button>
            </div>
            <div id="timelineOutput"></div>
        </div>
    </div>

    <div class="container">
        <div class="test-section">
            <h2>üîÑ Run All Tests</h2>
            <button class="success" onclick="runAllTests()">Run Complete Test Suite</button>
            <button onclick="clearAllResults()">Clear Results</button>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        
        function formatJson(obj) {
            return JSON.stringify(obj, null, 2);
        }

        function showResult(elementId, title, data, isError = false) {
            const element = document.getElementById(elementId);
            const className = isError ? 'error' : 'success';
            const timestamp = new Date().toLocaleTimeString();
            element.innerHTML = `
                <div class="test-section ${className}">
                    <h4>${title} (${timestamp})</h4>
                    <pre>${typeof data === 'string' ? data : formatJson(data)}</pre>
                </div>
            `;
        }

        function updateStatus(statusId, badgeId, status, symbol) {
            document.getElementById(statusId).textContent = symbol;
            const badge = document.getElementById(badgeId);
            badge.textContent = status;
            badge.className = `status-badge ${status === 'Working' ? 'status-working' : status === 'Error' ? 'status-error' : 'status-testing'}`;
        }

        async function testBackendHealth() {
            try {
                const response = await fetch(`${API_BASE}/../health`);
                if (response.ok) {
                    const data = await response.json();
                    showResult('healthOutput', '‚úÖ Backend Health Check', data);
                    document.getElementById('backendStatus').textContent = '‚úÖ';
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                showResult('healthOutput', '‚ùå Backend Health Check Failed', error.message, true);
                document.getElementById('backendStatus').textContent = '‚ùå';
            }
        }

        async function testCostEstimation() {
            updateStatus('costStatus', 'costBadge', 'Testing...', 'üîÑ');
            try {
                const requestData = {
                    cloud_provider: 'AWS',
                    target_region: 'us-east-1',
                    migration_type: 'lift_and_shift'
                };

                const response = await fetch(`${API_BASE}/cost-estimation`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                const summary = data.summary || {};
                const result = {
                    status: 'Success',
                    monthly_cost: summary.total_infrastructure_monthly,
                    migration_cost: summary.total_migration_cost,
                    data_size: Object.keys(data).length
                };

                showResult('costOutput', '‚úÖ Cost Estimation Success', result);
                updateStatus('costStatus', 'costBadge', 'Working', '‚úÖ');
            } catch (error) {
                showResult('costOutput', '‚ùå Cost Estimation Error', error.message, true);
                updateStatus('costStatus', 'costBadge', 'Error', '‚ùå');
            }
        }

        async function testCostEstimationDetailed() {
            try {
                const requestData = {
                    cloud_provider: 'AWS',
                    target_region: 'us-east-1',
                    migration_type: 'lift_and_shift'
                };

                const response = await fetch(`${API_BASE}/cost-estimation`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                showResult('costOutput', '‚úÖ Cost Estimation Full Response', data);
            } catch (error) {
                showResult('costOutput', '‚ùå Cost Estimation Detailed Error', error.message, true);
            }
        }

        async function testMigrationStrategy() {
            updateStatus('strategyStatus', 'strategyBadge', 'Testing...', 'üîÑ');
            try {
                const requestData = {
                    analysis_type: 'comprehensive'
                };

                const response = await fetch(`${API_BASE}/migration-strategy`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                const summary = data.executive_summary || {};
                const result = {
                    status: 'Success',
                    strategy: summary.recommended_strategy,
                    timeline_weeks: summary.estimated_timeline_weeks,
                    risk_level: summary.risk_level,
                    phases_count: data.migration_phases ? data.migration_phases.length : 0
                };

                showResult('strategyOutput', '‚úÖ Migration Strategy Success', result);
                updateStatus('strategyStatus', 'strategyBadge', 'Working', '‚úÖ');
            } catch (error) {
                showResult('strategyOutput', '‚ùå Migration Strategy Error', error.message, true);
                updateStatus('strategyStatus', 'strategyBadge', 'Error', '‚ùå');
            }
        }

        async function testMigrationStrategyDetailed() {
            try {
                const requestData = {
                    analysis_type: 'comprehensive'
                };

                const response = await fetch(`${API_BASE}/migration-strategy`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                showResult('strategyOutput', '‚úÖ Migration Strategy Full Response', data);
            } catch (error) {
                showResult('strategyOutput', '‚ùå Migration Strategy Detailed Error', error.message, true);
            }
        }

        async function testTimelineDefault() {
            updateStatus('timelineStatus', 'timelineBadge', 'Testing...', 'üîÑ');
            try {
                const response = await fetch(`${API_BASE}/timeline`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                const overview = data.project_overview || {};
                const result = {
                    status: 'Success - Default Date',
                    start_date: overview.estimated_start_date,
                    end_date: overview.estimated_end_date,
                    duration_weeks: overview.total_duration_weeks,
                    phases_count: data.phases ? data.phases.length : 0
                };

                showResult('timelineOutput', '‚úÖ Timeline Default Success', result);
                updateStatus('timelineStatus', 'timelineBadge', 'Working', '‚úÖ');
            } catch (error) {
                showResult('timelineOutput', '‚ùå Timeline Default Error', error.message, true);
                updateStatus('timelineStatus', 'timelineBadge', 'Error', '‚ùå');
            }
        }

        async function testTimelineCustomDate() {
            updateStatus('timelineStatus', 'timelineBadge', 'Testing...', 'üîÑ');
            try {
                const customDate = document.getElementById('customDate').value;
                const requestData = {
                    start_date: customDate
                };

                const response = await fetch(`${API_BASE}/timeline`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                const overview = data.project_overview || {};
                const result = {
                    status: 'Success - Custom Date',
                    requested_start_date: customDate,
                    actual_start_date: overview.estimated_start_date,
                    end_date: overview.estimated_end_date,
                    duration_weeks: overview.total_duration_weeks,
                    date_matches: customDate === overview.estimated_start_date
                };

                showResult('timelineOutput', '‚úÖ Timeline Custom Date Success', result);
                updateStatus('timelineStatus', 'timelineBadge', 'Working', '‚úÖ');
            } catch (error) {
                showResult('timelineOutput', '‚ùå Timeline Custom Date Error', error.message, true);
                updateStatus('timelineStatus', 'timelineBadge', 'Error', '‚ùå');
            }
        }

        async function runAllTests() {
            console.log('üöÄ Running complete test suite...');
            
            await testBackendHealth();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testCostEstimation();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testMigrationStrategy();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testTimelineDefault();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testTimelineCustomDate();
            
            console.log('‚úÖ Test suite completed');
        }

        function clearAllResults() {
            ['healthOutput', 'costOutput', 'strategyOutput', 'timelineOutput'].forEach(id => {
                document.getElementById(id).innerHTML = '';
            });
            
            ['costStatus', 'strategyStatus', 'timelineStatus'].forEach(id => {
                document.getElementById(id).textContent = '‚è≥';
            });
            
            ['costBadge', 'strategyBadge', 'timelineBadge'].forEach(id => {
                const badge = document.getElementById(id);
                badge.textContent = 'Ready';
                badge.className = 'status-badge status-testing';
            });
        }

        // Auto-run health check on page load
        window.addEventListener('load', () => {
            console.log('üîß Analysis & Planning API Test Page Loaded');
            testBackendHealth();
        });
    </script>
</body>
</html>

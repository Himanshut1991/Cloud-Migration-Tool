<!DOCTYPE html>
<html>
<head>
    <title>File Shares Debug Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .response {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 11px;
            max-height: 400px;
            overflow: auto;
            border: 1px solid #ddd;
            margin: 10px 0;
        }
        button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #40a9ff;
        }
        .error {
            color: red;
            background: #fff2f0;
            border-color: #ffccc7;
        }
        .success {
            color: green;
            background: #f6ffed;
            border-color: #b7eb8f;
        }
        .section {
            margin-bottom: 30px;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
        }
        .debug-info {
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            padding: 10px;
            border-radius: 3px;
            margin: 10px 0;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç File Shares Debug Test</h1>
        
        <div class="section">
            <h2>üìÅ File Shares API Response</h2>
            <button onclick="testFileShares()">Test File Shares API</button>
            <button onclick="clearResponse('fileSharesResponse')">Clear</button>
            <div id="fileSharesDebug" class="debug-info">Click button to test API...</div>
            <div id="fileSharesResponse" class="response"></div>
        </div>

        <div class="section">
            <h2>üñ•Ô∏è Servers API Response</h2>
            <button onclick="testServers()">Test Servers API</button>
            <button onclick="clearResponse('serversResponse')">Clear</button>
            <div id="serversDebug" class="debug-info">Click button to test API...</div>
            <div id="serversResponse" class="response"></div>
        </div>

        <div class="section">
            <h2>üè† Dashboard API Response</h2>
            <button onclick="testDashboard()">Test Dashboard API</button>
            <button onclick="clearResponse('dashboardResponse')">Clear</button>
            <div id="dashboardDebug" class="debug-info">Click button to test API...</div>
            <div id="dashboardResponse" class="response"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';

        function clearResponse(elementId) {
            document.getElementById(elementId).textContent = '';
            document.getElementById(elementId.replace('Response', 'Debug')).textContent = 'Cleared.';
        }

        async function testEndpoint(endpoint, responseElementId, debugElementId) {
            const responseEl = document.getElementById(responseElementId);
            const debugEl = document.getElementById(debugElementId);
            
            debugEl.textContent = `‚è≥ Testing ${endpoint}...`;
            responseEl.textContent = 'Loading...';
            responseEl.className = 'response';
            
            try {
                const startTime = Date.now();
                console.log(`üîç Testing ${endpoint}...`);
                
                const response = await fetch(`${API_BASE}${endpoint}`);
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                console.log(`üì° Response status: ${response.status} (${duration}ms)`);
                debugEl.textContent = `üì° Status: ${response.status} | ‚è±Ô∏è Time: ${duration}ms | üìÖ ${new Date().toLocaleTimeString()}`;
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log(`‚úÖ ${endpoint} response:`, data);
                
                // Format the response nicely
                let formattedResponse = JSON.stringify(data, null, 2);
                
                // Add extra info for analysis
                if (data && typeof data === 'object') {
                    const keys = Object.keys(data);
                    const totalKeys = keys.length;
                    let extraInfo = `\n\n=== ANALYSIS ===\nTop-level keys: ${keys.join(', ')}\nTotal keys: ${totalKeys}\n`;
                    
                    // Analyze array properties
                    keys.forEach(key => {
                        const value = data[key];
                        if (Array.isArray(value)) {
                            extraInfo += `${key}: Array with ${value.length} items\n`;
                            if (value.length > 0 && typeof value[0] === 'object') {
                                extraInfo += `  ‚îî‚îÄ First item keys: ${Object.keys(value[0]).join(', ')}\n`;
                            }
                        } else if (typeof value === 'object' && value !== null) {
                            extraInfo += `${key}: Object with keys: ${Object.keys(value).join(', ')}\n`;
                        } else {
                            extraInfo += `${key}: ${typeof value} = ${value}\n`;
                        }
                    });
                    formattedResponse += extraInfo;
                }
                
                responseEl.textContent = formattedResponse;
                responseEl.className = 'response success';
                debugEl.textContent += ' ‚úÖ Success!';
                
            } catch (error) {
                console.error(`‚ùå Error testing ${endpoint}:`, error);
                responseEl.textContent = `‚ùå Error: ${error.message}\n\nFull error: ${JSON.stringify(error, null, 2)}`;
                responseEl.className = 'response error';
                debugEl.textContent += ` ‚ùå Failed: ${error.message}`;
            }
        }

        function testFileShares() {
            testEndpoint('/file-shares', 'fileSharesResponse', 'fileSharesDebug');
        }

        function testServers() {
            testEndpoint('/servers', 'serversResponse', 'serversDebug');
        }

        function testDashboard() {
            testEndpoint('/dashboard', 'dashboardResponse', 'dashboardDebug');
        }

        // Auto-run tests on page load
        window.addEventListener('load', () => {
            console.log('üöÄ Auto-testing APIs on page load...');
            setTimeout(testFileShares, 500);
            setTimeout(testServers, 1000);
            setTimeout(testDashboard, 1500);
        });
    </script>
</body>
</html>

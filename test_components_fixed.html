<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Both AI Components - FIXED CONFIDENCE</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .card { background: white; padding: 20px; margin: 15px 0; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .ai-status { padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #52c41a; background: #f6ffed; }
        .fallback-status { padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #faad14; background: #fffbe6; }
        .error { background: #fff2f0; border-left-color: #ff4d4f; color: #a8071a; }
        .tag { display: inline-block; padding: 4px 8px; margin: 4px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .tag-green { background: #f6ffed; color: #52c41a; border: 1px solid #b7eb8f; }
        .tag-orange { background: #fff7e6; color: #fa8c16; border: 1px solid #ffd591; }
        .tag-purple { background: #f9f0ff; color: #722ed1; border: 1px solid #d3adf7; }
        .tag-blue { background: #e6f7ff; color: #1890ff; border: 1px solid #91d5ff; }
        .result { margin: 20px 0; padding: 15px; border-radius: 5px; background: #f8f9fa; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>ðŸ”§ AI Components Test - CONFIDENCE FIX APPLIED</h1>
            <p>Testing both Cost Estimation and Migration Strategy AI components with confidence percentage fix</p>
            <button onclick="testBothAPIs()">Test Both APIs</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        async function testBothAPIs() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="card"><h3>Testing APIs...</h3></div>';

            try {
                // Test Cost Estimation
                console.log('Testing Cost Estimation...');
                const costResponse = await fetch('http://localhost:5000/api/cost-estimation', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        cloud_provider: 'AWS',
                        target_region: 'us-east-1',
                        migration_type: 'lift_and_shift'
                    })
                });
                const costData = await costResponse.json();

                // Test Migration Strategy
                console.log('Testing Migration Strategy...');
                const strategyResponse = await fetch('http://localhost:5000/api/migration-strategy', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        cloud_provider: 'AWS',
                        target_region: 'us-east-1',
                        migration_type: 'lift_and_shift'
                    })
                });
                const strategyData = await strategyResponse.json();

                displayResults(costData, strategyData);

            } catch (error) {
                console.error('Error:', error);
                resultsDiv.innerHTML = `<div class="card error"><h3>Error: ${error.message}</h3></div>`;
            }
        }

        function displayResults(costData, strategyData) {
            const resultsDiv = document.getElementById('results');
            
            let html = '';

            // Cost Estimation Results
            if (costData.ai_insights) {
                const costConf = Math.round(costData.ai_insights.confidence_level * 100);
                html += `
                    <div class="card">
                        <h3>ðŸ’° Cost Estimation AI Status</h3>
                        <div class="result">
                            <h4>ðŸ¤– AI Cost Analysis 
                                <span class="tag ${costData.ai_insights.fallback_used ? 'tag-orange' : 'tag-green'}">${costConf}% Confidence</span>
                `;
                
                if (costData.ai_insights.fallback_used) {
                    html += `<span class="tag tag-blue">Rule-based</span>`;
                } else {
                    html += `<span class="tag tag-purple">${costData.ai_insights.ai_model_used}</span>`;
                }
                
                html += `</h4>`;
                
                const statusClass = costData.ai_insights.fallback_used ? 'fallback-status' : 'ai-status';
                const statusMessage = costData.ai_insights.fallback_used ? 
                    'Using Advanced Rule-based Analysis - AI services temporarily unavailable' :
                    `AI-Powered Analysis Active - ${costData.ai_insights.ai_model_used} with ${costConf}% confidence`;
                
                html += `<div class="${statusClass}"><strong>${statusMessage}</strong></div>`;
                html += `<p><strong>Raw confidence value from API:</strong> ${costData.ai_insights.confidence_level}</p>`;
                html += `<p><strong>Formatted confidence (Ã—100):</strong> ${costConf}%</p>`;
                html += `<p><strong>Fallback used:</strong> ${costData.ai_insights.fallback_used}</p>`;
                html += `</div></div>`;
            }

            // Migration Strategy Results
            if (strategyData.ai_insights) {
                const stratConf = Math.round(strategyData.ai_insights.confidence_level * 100);
                html += `
                    <div class="card">
                        <h3>ðŸš€ Migration Strategy AI Status</h3>
                        <div class="result">
                            <h4>ðŸ¤– AI Strategy Analysis 
                                <span class="tag ${strategyData.ai_insights.fallback_used ? 'tag-orange' : 'tag-green'}">${stratConf}% Confidence</span>
                `;
                
                if (strategyData.ai_insights.fallback_used) {
                    html += `<span class="tag tag-blue">Rule-based</span>`;
                } else {
                    html += `<span class="tag tag-purple">${strategyData.ai_insights.ai_model_used}</span>`;
                }
                
                html += `</h4>`;
                
                const statusClass = strategyData.ai_insights.fallback_used ? 'fallback-status' : 'ai-status';
                const statusMessage = strategyData.ai_insights.fallback_used ? 
                    'Using Advanced Rule-based Analysis - AI services temporarily unavailable' :
                    `AI-Powered Analysis Active - ${strategyData.ai_insights.ai_model_used} with ${stratConf}% confidence`;
                
                html += `<div class="${statusClass}"><strong>${statusMessage}</strong></div>`;
                html += `<p><strong>Raw confidence value from API:</strong> ${strategyData.ai_insights.confidence_level}</p>`;
                html += `<p><strong>Formatted confidence (Ã—100):</strong> ${stratConf}%</p>`;
                html += `<p><strong>Fallback used:</strong> ${strategyData.ai_insights.fallback_used}</p>`;
                html += `</div></div>`;
            }

            resultsDiv.innerHTML = html;
        }

        // Auto-run on page load
        document.addEventListener('DOMContentLoaded', () => {
            testBothAPIs();
        });
    </script>
</body>
</html>

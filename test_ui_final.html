<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final UI Test - Cloud Migration Tool</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-section { 
            background: white;
            margin: 20px 0; 
            padding: 20px; 
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px;
        }
        .success { 
            background-color: #d4edda; 
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error { 
            background-color: #f8d7da; 
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info { 
            background-color: #d1ecf1; 
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button { 
            background-color: #007bff; 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px;
        }
        button:hover { 
            background-color: #0056b3; 
        }
        .loading {
            color: #666;
            font-style: italic;
        }
        pre {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            border: 1px solid #e9ecef;
        }
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .endpoint-url {
            font-family: monospace;
            background-color: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            color: #e83e8c;
        }
    </style>
</head>
<body>
    <h1>üîç Final UI Test - Cloud Migration Tool</h1>
    <p>This page tests all the analysis endpoints and simulates frontend behavior.</p>
    
    <div class="test-grid">
        <div class="test-section">
            <h2>üí∞ Cost Estimation Test</h2>
            <div id="cost-status" class="status info">Ready to test</div>
            <button onclick="testCostEstimation()">Test Cost Estimation API</button>
            <div id="cost-results"></div>
        </div>
        
        <div class="test-section">
            <h2>üöÄ Migration Strategy Test</h2>
            <div id="strategy-status" class="status info">Ready to test</div>
            <button onclick="testMigrationStrategy()">Test Migration Strategy API</button>
            <div id="strategy-results"></div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>üìÖ Timeline Test with Custom Start Date</h2>
        <div id="timeline-status" class="status info">Ready to test</div>
        <div>
            <label for="start-date">Custom Start Date:</label>
            <input type="date" id="start-date" value="2024-02-15">
            <button onclick="testTimeline()">Test Timeline API</button>
            <button onclick="testTimelineDefault()">Test Timeline (Default Date)</button>
        </div>
        <div id="timeline-results"></div>
    </div>
    
    <div class="test-section">
        <h2>üîó Frontend URL Tests</h2>
        <div class="status info">
            <p>Test the actual frontend pages:</p>
            <ul>
                <li><a href="http://localhost:5173/analysis/cost-estimation" target="_blank">Cost Estimation Page</a></li>
                <li><a href="http://localhost:5173/analysis/migration-strategy" target="_blank">Migration Strategy Page</a></li>
                <li><a href="http://localhost:5173/analysis/timeline" target="_blank">Timeline Page</a></li>
            </ul>
        </div>
    </div>

    <script>
        const BASE_URL = 'http://localhost:5000/api';
        
        function updateStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }
        
        function displayResults(elementId, data) {
            const element = document.getElementById(elementId);
            if (typeof data === 'object') {
                element.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            } else {
                element.innerHTML = `<p>${data}</p>`;
            }
        }
        
        async function testCostEstimation() {
            updateStatus('cost-status', 'Testing cost estimation...', 'loading');
            
            try {
                const requestData = {
                    cloud_provider: 'AWS',
                    target_region: 'us-east-1',
                    migration_type: 'lift_and_shift'
                };
                
                const response = await fetch(`${BASE_URL}/cost-estimation`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                updateStatus('cost-status', 'Cost estimation successful!', 'success');
                
                // Display summary
                const summary = {
                    total_infrastructure_annual: data.summary?.total_infrastructure_annual || 'N/A',
                    total_migration_cost: data.summary?.total_migration_cost || 'N/A',
                    total_first_year: data.summary?.total_first_year || 'N/A',
                    server_count: data.cloud_infrastructure?.servers?.server_recommendations?.length || 0,
                    database_count: data.cloud_infrastructure?.databases?.database_recommendations?.length || 0
                };
                
                displayResults('cost-results', summary);
                
            } catch (error) {
                updateStatus('cost-status', `Error: ${error.message}`, 'error');
                displayResults('cost-results', error.message);
            }
        }
        
        async function testMigrationStrategy() {
            updateStatus('strategy-status', 'Testing migration strategy...', 'loading');
            
            try {
                const requestData = {
                    cloud_provider: 'AWS',
                    migration_approach: 'lift_and_shift'
                };
                
                const response = await fetch(`${BASE_URL}/migration-strategy`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                updateStatus('strategy-status', 'Migration strategy successful!', 'success');
                
                // Display summary
                const summary = {
                    recommended_strategy: data.executive_summary?.recommended_strategy || 'N/A',
                    confidence_score: data.executive_summary?.confidence_score || 'N/A',
                    estimated_timeline_weeks: data.executive_summary?.estimated_timeline_weeks || 'N/A',
                    migration_complexity: data.executive_summary?.migration_complexity || 'N/A',
                    risk_level: data.executive_summary?.risk_level || 'N/A',
                    phase_count: data.migration_phases?.length || 0
                };
                
                displayResults('strategy-results', summary);
                
            } catch (error) {
                updateStatus('strategy-status', `Error: ${error.message}`, 'error');
                displayResults('strategy-results', error.message);
            }
        }
        
        async function testTimeline(useCustomDate = false) {
            updateStatus('timeline-status', 'Testing timeline...', 'loading');
            
            try {
                let requestData = {};
                
                if (useCustomDate) {
                    const startDate = document.getElementById('start-date').value;
                    if (startDate) {
                        requestData.start_date = startDate;
                    }
                }
                
                const response = await fetch(`${BASE_URL}/timeline`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                updateStatus('timeline-status', 'Timeline successful!', 'success');
                
                // Display summary
                const summary = {
                    estimated_start_date: data.project_overview?.estimated_start_date || 'N/A',
                    estimated_end_date: data.project_overview?.estimated_end_date || 'N/A',
                    total_duration_weeks: data.project_overview?.total_duration_weeks || 'N/A',
                    total_duration_months: data.project_overview?.total_duration_months || 'N/A',
                    confidence_level: data.project_overview?.confidence_level || 'N/A',
                    complexity_score: data.project_overview?.complexity_score || 'N/A',
                    phase_count: data.phases?.length || 0,
                    critical_path: data.critical_path || []
                };
                
                displayResults('timeline-results', summary);
                
            } catch (error) {
                updateStatus('timeline-status', `Error: ${error.message}`, 'error');
                displayResults('timeline-results', error.message);
            }
        }
        
        function testTimelineDefault() {
            testTimeline(false);
        }
        
        // Auto-test on page load
        window.onload = function() {
            updateStatus('cost-status', 'Ready - Click button to test', 'info');
            updateStatus('strategy-status', 'Ready - Click button to test', 'info');
            updateStatus('timeline-status', 'Ready - Click button to test', 'info');
        };
    </script>
</body>
</html>

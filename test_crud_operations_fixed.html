<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test CRUD Operations - Fixed</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            max-height: 300px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üîß CRUD Operations Test - Fixed</h1>
    <p><strong>Testing Date:</strong> <span id="testDate"></span></p>
    
    <div class="test-section">
        <h2>üñ•Ô∏è Test Server CRUD Operations</h2>
        <button onclick="testServerCreate()">Test Add Server</button>
        <button onclick="testServerUpdate()">Test Update Server</button>
        <button onclick="testServerDelete()">Test Delete Server</button>
        <div id="serverResult"></div>
    </div>

    <div class="test-section">
        <h2>üóÑÔ∏è Test Database CRUD Operations</h2>
        <button onclick="testDatabaseCreate()">Test Add Database</button>
        <button onclick="testDatabaseUpdate()">Test Update Database</button>
        <button onclick="testDatabaseDelete()">Test Delete Database</button>
        <div id="databaseResult"></div>
    </div>

    <div class="test-section">
        <h2>üìÅ Test File Share CRUD Operations</h2>
        <button onclick="testFileShareCreate()">Test Add File Share</button>
        <button onclick="testFileShareUpdate()">Test Update File Share</button>
        <button onclick="testFileShareDelete()">Test Delete File Share</button>
        <div id="fileShareResult"></div>
    </div>

    <div class="test-section">
        <h2>üí∞ Test Resource Rate CRUD Operations</h2>
        <button onclick="testResourceRateCreate()">Test Add Resource Rate</button>
        <button onclick="testResourceRateUpdate()">Test Update Resource Rate</button>
        <button onclick="testResourceRateDelete()">Test Delete Resource Rate</button>
        <div id="resourceRateResult"></div>
    </div>

    <script>
        document.getElementById('testDate').textContent = new Date().toLocaleString();

        async function testServerCreate() {
            const resultDiv = document.getElementById('serverResult');
            resultDiv.innerHTML = '<div class="status info">üîÑ Testing server creation...</div>';

            try {
                const testServer = {
                    server_id: 'TEST-SRV-' + Date.now(),
                    os_type: 'Linux',
                    vcpu: 4,
                    ram: 16,
                    disk_size: 500,
                    disk_type: 'SSD',
                    uptime_pattern: '24x7',
                    current_hosting: 'On-Premise',
                    technology: 'Web Server',
                    technology_version: '1.0'
                };

                const response = await fetch('http://localhost:5000/api/servers', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testServer)
                });

                const result = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="status success">‚úÖ Server created successfully!</div>
                        <pre>${JSON.stringify({testServer, result}, null, 2)}</pre>
                    `;
                } else {
                    throw new Error(JSON.stringify(result));
                }

            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">‚ùå Server creation failed</div>
                    <pre>Error: ${error.message}</pre>
                `;
            }
        }

        async function testServerUpdate() {
            const resultDiv = document.getElementById('serverResult');
            resultDiv.innerHTML = '<div class="status info">üîÑ Testing server update...</div>';

            try {
                // First get existing servers to find one to update
                const getResponse = await fetch('http://localhost:5000/api/servers');
                const getData = await getResponse.json();
                const servers = getData.servers || getData;
                
                if (servers.length === 0) {
                    throw new Error('No servers found to update');
                }

                const serverId = servers[0].id;
                const updateData = {
                    ...servers[0],
                    server_id: 'UPDATED-' + servers[0].server_id,
                    ram: 32 // Update RAM
                };

                const response = await fetch(`http://localhost:5000/api/servers/${serverId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });

                const result = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="status success">‚úÖ Server updated successfully!</div>
                        <pre>${JSON.stringify({updateData, result}, null, 2)}</pre>
                    `;
                } else {
                    throw new Error(JSON.stringify(result));
                }

            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">‚ùå Server update failed</div>
                    <pre>Error: ${error.message}</pre>
                `;
            }
        }

        async function testServerDelete() {
            const resultDiv = document.getElementById('serverResult');
            resultDiv.innerHTML = '<div class="status info">üîÑ Testing server deletion...</div>';

            try {
                // First get existing servers to find one to delete
                const getResponse = await fetch('http://localhost:5000/api/servers');
                const getData = await getResponse.json();
                const servers = getData.servers || getData;
                
                if (servers.length === 0) {
                    throw new Error('No servers found to delete');
                }

                const serverId = servers[servers.length - 1].id; // Delete last server
                
                const response = await fetch(`http://localhost:5000/api/servers/${serverId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="status success">‚úÖ Server deleted successfully!</div>
                        <pre>Deleted server ID: ${serverId}
Result: ${JSON.stringify(result, null, 2)}</pre>
                    `;
                } else {
                    throw new Error(JSON.stringify(result));
                }

            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">‚ùå Server deletion failed</div>
                    <pre>Error: ${error.message}</pre>
                `;
            }
        }

        // Similar functions for databases, file shares, and resource rates would follow the same pattern
        async function testDatabaseCreate() {
            const resultDiv = document.getElementById('databaseResult');
            resultDiv.innerHTML = '<div class="status info">üîÑ Testing database creation...</div>';

            try {
                const testDb = {
                    db_name: 'TEST-DB-' + Date.now(),
                    db_type: 'MySQL',
                    size_gb: 100,
                    ha_dr_required: false,
                    backup_frequency: 'Daily',
                    licensing_model: 'Open Source',
                    server_id: 1,
                    write_frequency: 'Medium',
                    downtime_tolerance: 'Low',
                    real_time_sync: false
                };

                const response = await fetch('http://localhost:5000/api/databases', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testDb)
                });

                const result = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `<div class="status success">‚úÖ Database created!</div><pre>${JSON.stringify(result, null, 2)}</pre>`;
                } else {
                    throw new Error(JSON.stringify(result));
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="status error">‚ùå Database creation failed</div><pre>${error.message}</pre>`;
            }
        }

        // Placeholder functions for other operations
        async function testDatabaseUpdate() { document.getElementById('databaseResult').innerHTML = '<div class="status info">Database update test - implementation similar to server update</div>'; }
        async function testDatabaseDelete() { document.getElementById('databaseResult').innerHTML = '<div class="status info">Database delete test - implementation similar to server delete</div>'; }
        async function testFileShareCreate() { document.getElementById('fileShareResult').innerHTML = '<div class="status info">File share create test - similar pattern</div>'; }
        async function testFileShareUpdate() { document.getElementById('fileShareResult').innerHTML = '<div class="status info">File share update test - similar pattern</div>'; }
        async function testFileShareDelete() { document.getElementById('fileShareResult').innerHTML = '<div class="status info">File share delete test - similar pattern</div>'; }
        async function testResourceRateCreate() { document.getElementById('resourceRateResult').innerHTML = '<div class="status info">Resource rate create test - similar pattern</div>'; }
        async function testResourceRateUpdate() { document.getElementById('resourceRateResult').innerHTML = '<div class="status info">Resource rate update test - similar pattern</div>'; }
        async function testResourceRateDelete() { document.getElementById('resourceRateResult').innerHTML = '<div class="status info">Resource rate delete test - similar pattern</div>'; }
    </script>
</body>
</html>

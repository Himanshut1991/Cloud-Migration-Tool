<!DOCTYPE html>
<html>
<head>
    <title>Database Data Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .loading { color: blue; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Database Inventory - Debug Version</h1>
    <div id="status" class="loading">Loading...</div>
    <div id="count"></div>
    <table id="databaseTable" style="display:none;">
        <thead>
            <tr>
                <th>Database Name</th>
                <th>DB Type</th>
                <th>Size (GB)</th>
                <th>Server ID</th>
                <th>Write Frequency</th>
                <th>Backup Frequency</th>
                <th>HA/DR Required</th>
                <th>Licensing Model</th>
            </tr>
        </thead>
        <tbody id="databaseTableBody"></tbody>
    </table>

    <script>
        // Test the database API endpoint
        async function fetchDatabases() {
            const statusDiv = document.getElementById('status');
            const countDiv = document.getElementById('count');
            const table = document.getElementById('databaseTable');
            const tableBody = document.getElementById('databaseTableBody');
            
            console.log('üîÑ Starting to fetch databases...');
            statusDiv.textContent = 'Fetching databases...';
            statusDiv.className = 'loading';
            
            try {
                console.log('üåê Making request to http://127.0.0.1:5000/api/databases');
                const response = await fetch('http://127.0.0.1:5000/api/databases');
                console.log(`üì° Response status: ${response.status}`);
                
                const data = await response.json();
                console.log('‚úÖ Data received:', data);
                
                // Extract databases array exactly like React component
                let databases = [];
                if (data.databases && Array.isArray(data.databases)) {
                    databases = data.databases;
                    console.log(`‚úÖ Found ${databases.length} databases`);
                } else {
                    console.warn('‚ö†Ô∏è Unexpected data format:', data);
                    // Maybe the backend returns an array directly?
                    if (Array.isArray(data)) {
                        databases = data;
                        console.log(`‚úÖ Data is direct array with ${databases.length} databases`);
                    }
                }
                
                if (databases.length > 0) {
                    statusDiv.textContent = 'Data loaded successfully!';
                    statusDiv.className = 'success';
                    countDiv.textContent = `Found ${databases.length} databases`;
                    
                    // Populate table
                    databases.forEach(db => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${db.db_name || 'N/A'}</td>
                            <td>${db.db_type || 'N/A'}</td>
                            <td>${db.size_gb || 'N/A'}</td>
                            <td>${db.server_id || 'N/A'}</td>
                            <td>${db.write_frequency || 'N/A'}</td>
                            <td>${db.backup_frequency || 'N/A'}</td>
                            <td>${db.ha_dr_required ? 'Yes' : 'No'}</td>
                            <td>${db.licensing_model || 'N/A'}</td>
                        `;
                        tableBody.appendChild(row);
                    });
                    
                    table.style.display = 'table';
                } else {
                    statusDiv.textContent = 'No databases found';
                    statusDiv.className = 'error';
                    countDiv.textContent = 'No databases in response';
                    
                    // Show raw data for debugging
                    const debugDiv = document.createElement('div');
                    debugDiv.innerHTML = `<h3>Raw Response:</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
                    document.body.appendChild(debugDiv);
                }
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                statusDiv.textContent = `Error: ${error.message}`;
                statusDiv.className = 'error';
                countDiv.textContent = 'Failed to fetch data';
            }
        }
        
        // Start fetch on page load
        window.onload = fetchDatabases;
    </script>
</body>
</html>
